!function(a){"use strict";var b=function(b){this.element=a(b)};b.prototype={constructor:b,show:function(){var b=this.element,c=b.closest("ul:not(.dropdown-menu)"),d=b.attr("data-target"),e,f,g;d||(d=b.attr("href"),d=d&&d.replace(/.*(?=#[^\s]*$)/,""));if(b.parent("li").hasClass("active"))return;e=c.find(".active a").last()[0],g=a.Event("show",{relatedTarget:e}),b.trigger(g);if(g.isDefaultPrevented())return;f=a(d),this.activate(b.parent("li"),c),this.activate(f,f.parent(),function(){b.trigger({type:"shown",relatedTarget:e})})},activate:function(b,c,d){function g(){e.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),b.addClass("active"),f?(b[0].offsetWidth,b.addClass("in")):b.removeClass("fade"),b.parent(".dropdown-menu")&&b.closest("li.dropdown").addClass("active"),d&&d()}var e=c.find("> .active"),f=d&&a.support.transition&&e.hasClass("fade");f?e.one(a.support.transition.end,g):g(),e.removeClass("in")}},a.fn.tab=function(c){return this.each(function(){var d=a(this),e=d.data("tab");e||d.data("tab",e=new b(this)),typeof c=="string"&&e[c]()})},a.fn.tab.Constructor=b,a(function(){a("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(b){b.preventDefault(),a(this).tab("show")})})}(window.jQuery),window.courseData=[{name:"Introduction to Parallel Programming",faculty:"Science",id:"CPSC 418",terms:[1],status:"Full",schedule:{days:["Tue","Thu"],hours:["15:30","16:00","16:30"]}},{name:"Introduction to Human Computer Interaction",faculty:"Science",id:"CPSC 344",terms:[1,2],status:"Open",schedule:{days:["Tue","Thu"],hours:["9:30","10:00","10:30"]}},{name:"Data Mining and Machine Learning",faculty:"Science",id:"CPSC 314",terms:[1],status:"Open",schedule:{days:["Mon","Wed","Fri"],hours:["15:00","15:30"]}},{name:"Computer Graphics",faculty:"Science",id:"CPSC 318",terms:[1,2],status:"Waitlist",schedule:{days:["Mon","Wed","Fri"],hours:["9:00","9:30"]}},{name:"Software Construction",faculty:"Science",id:"CPSC 212",terms:[2],status:"Registered",schedule:{days:["Mon","Wed","Fri"],hours:["11:00","11:30"]}},{name:"Computing in the Life Sciences",faculty:"Science",id:"CPSC 218",terms:[2],status:"Registered",schedule:{days:["Mon","Wed","Fri"],hours:["9:00","9:30"]}}],$(document).ready(function(){var a=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],b=function(b,c){return b.checked=ko.observable(!1),b.isFull=ko.observable(b.status=="Full"?!0:!1),b.isWaitingList=ko.observable(b.status=="Waitlist"?!0:!1),b.isOpen=ko.observable(b.status=="Open"?!0:!1),b.isRegistered=ko.observable(b.status=="Registered"?!0:!1),b.id=b.id||b.courseId,b.color=ko.observable(),b.isFull()?b.color("#B94A48"):b.isWaitingList()?b.color("gray"):b.isRegistered()?b.color("black"):b.color(a[c]),b},c=function(a,b,c,e){var f={};return f.hour="",f.militarHour=0,f.index=0,f.days=[],f.color=ko.observable(),f.init=function(a,b,c,e){return f.hour=a,f.militarHour=b,f.index=c,f.color("white"),e.unshift(""),$.each(e,function(a,b){f.days.push(new d(b,f.index,a))}),f},f.init(a,b,c,e)},d=function(a,b,c){var d={};return d.name="",d.parentIndex=0,d.index=0,d.color=ko.observable("white"),d.course=ko.observable({id:null}),d.isFirstColumn=function(a){return a()==0},d.init=function(a,b,c){return d.parentIndex=b,d.index=c,d.name=a,d},d.init(a,b,c)},e=function(){var a={},b=["Mon","Tue","Wed","Thu","Fri","Sat"],d=30,e=800,f=2300,g=20;a.hours=ko.observableArray([]),a.classesHours=ko.observableArray([]),a.minimumHourDisplay=ko.observable(e),a.maximumHourDisplay=ko.observable(f),a.days=[];var h=function(a){var b=parseInt(a/100),c=a%100;return b+":"+c};a.parseStringHourToMilitar=function(a){var b=a.split(/:/ig),c=parseInt(b[0])*100,d=parseInt(b[1]);return c+d};var i=function(a){var e=d||30,f=1440,g=[],i=!1,j="",k=0;for(var l=0;l<f;l+=e)k=parseInt(l/60)*100+l%60,j=h(k),i=l%60==0?!0:!1,i&&(j+="0"),g.push(new c(j,k,l/e,b.slice(0)));a(g)},j=function(a,b){var c=[],d=0;c=ko.utils.arrayFilter(a(),function(a){return a.militarHour>e&&a.militarHour<f&&d++<g}),b(c)};return a.up=function(){var b=a.minimumHourDisplay();if(b>e){var c=a.classesHours()[0],d=a.hours()[c.index-1],f=a.classesHours()[a.classesHours().length-2];a.minimumHourDisplay(d.militarHour),a.maximumHourDisplay(f.militarHour),a.classesHours.unshift(d),a.classesHours.pop()}},a.down=function(){var b=a.maximumHourDisplay();if(b<=f){var c=a.classesHours()[a.classesHours().length-1],d=a.hours()[c.index+1],e=a.classesHours()[0];a.maximumHourDisplay(d.militarHour),a.minimumHourDisplay(e.militarHour),a.classesHours.push(d),a.classesHours.shift()}},a.init=function(){i(a.hours),j(a.hours,a.classesHours);var c=b.slice(0);return c.unshift(" "),a.days=c,a},a.init()},f=function(){var a={};return a.input=ko.observable(),a.backlog=ko.observableArray([]),a.results=ko.observableArray([]),a.containsElements=ko.computed(function(){return a.results().length>0}),a.removeFromBacklog=function(b){a.backlog.remove(b)},a.addToBacklog=function(b){a.backlog.push(b)},a.cleanInput=function(){a.input(""),a.results.removeAll()},a.input.subscribe(function(b){if(b.length===0){a.cleanInput();return}var c=ko.utils.arrayFilter(a.backlog(),function(a){var c=a.name,d=c.split(/\W+/g),e="";for(var f=0;f<d.length;f++){e=d[f].toLowerCase();if(e.indexOf(b.toLowerCase())>=0)return!0}return!1});a.results(c)}),a.load=function(a){},a.init=function(){return a},a.init()},g=function(a){var c={};return c.isActive=ko.observable(!0),c.name=ko.observable(""),c.label=ko.observable(""),c.timetable=ko.observable({}),c.search=ko.observable({}),c.courses=ko.observableArray([]),c.hasConflict=ko.observable(!1),c.courseConflictA=ko.observable(),c.courseConflictB=ko.observable(),c.hasCourses=ko.computed(function(){return c.courses().length>0}),c.paintCourseInTimetable=function(a,b){var d=c.timetable(),e=a.schedule.days,f=a.schedule.hours,g=[];$.each(f,function(a,b){$.each(d.hours(),function(a,c){c.hour==b&&g.push(a)})});var h=[],i=d.hours()[0].days;$.each(e,function(a,b){$.each(i,function(a,c){c.name==b&&h.push(a)})});var j=[];$.each(g,function(e,f){j=d.hours()[f].days,$.each(j,function(d,e){$.each(h,function(d,f){if(e.index==f){var g=e.course;b=="Repaint"?e.color("black"):g().id&&b==="Add"?(e.color("red"),c.courseConflictA(" "+g().name+" "),c.courseConflictB(" "+a.name+" "),c.hasConflict(!0)):(b==="Add"&&!c.hasConflict()&&(e.course(a),e.color(a.color())),b==="Remove"&&(e.course({id:null}),e.color("white")))}})})})},c.updateLabel=function(){c.label=c.name().replace(/ /ig,"_")},c.parseCourses=function(a){var d;$.each(a,function(a,e){d=new b(e.attributes,a);var f=c.search().backlog();d.isRegistered()?c.paintOver(d):c.addCourse(d)})},c.load=function(){Parse.initialize("s5XRK5EQxsoLQ7bd9lIz35fqKaWHTTNQwQCXkr3O","8sYc7dACntCwXHSMC3qJ4TaTO8k3DgKuVl0wOQc9");var a=Parse.Object.extend("courses"),b=new Parse.Query(a);b.find({success:c.parseCourses,error:function(a){console.log("Connection error with the database.")}})},c.mockLoad=function(){var a=[];$.each(window.courseData,function(b,c){var d=new Object;d.attributes=c,a.push(d)}),c.parseCourses(a)},c.init=function(a){var b="Worklist "+a;return c.name=ko.observable(b),c.updateLabel(),c.timetable=ko.observable(new e),c.search=ko.observable(new f),c.mockLoad(),c},c.paintOver=function(a){c.paintCourseInTimetable(a,"Add")},c.paintOut=function(a){c.hasConflict()?c.paintCourseInTimetable(a,"Repaint"):c.paintCourseInTimetable(a,"Remove"),c.hasConflict(!1)},c.addCourse=function(a){c.courses.push(a);var b=c.search();return b.removeFromBacklog(a),b.cleanInput(),!1},c.removeCourse=function(a){c.courses.remove(a);var b=c.search();b.addToBacklog(a)},c.init(a)},h=function(){var a=this;return a.currentWorklist=ko.observable({}),a.worklists=ko.observableArray([]),a.copyActive=function(){var b=a.currentWorklist().courses(),c=new g(a.worklists().length+1);for(var d=0;d<b.length;d++)c.addCourse(b[d]);c.name(c.name()+" (Copy)"),c.updateLabel(),console.log(c.courses()),a.currentWorklist(c),a.worklists.push(c),a.selectWorklist(c)},a.addWorklist=function(){var b=new g(a.worklists().length+1);a.currentWorklist(b),a.worklists.push(b),a.selectWorklist(b)},a.selectWorklist=function(b){var c=a.worklists();for(var d=0;d<c.length;d++)c[d].isActive(!1);b.isActive(!0),a.currentWorklist(b)},a.register=function(){var b=a.currentWorklist(),c=b.courses(),d=[];if(!c.length){alert("Please select at least one course to your worklist.");return}for(var e=0;e<c.length;e++)c[e].checked()&&d.push(c[e]);if(!d.length){alert("Please check the courses to register.");return}var f="";for(var g=0;g<d.length;g++)f+=d[g].name+", ";return result=confirm("Are you sure you want to register: "+f),result&&alert("Demo is completed. Thank you."),!1},a.init=function(){a.addWorklist()},a.init()};ko.applyBindings(new h,document.getElementById("worklist"))});